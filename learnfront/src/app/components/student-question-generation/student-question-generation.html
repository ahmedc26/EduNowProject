<app-nav-bar></app-nav-bar>
<div class="question-generator-container">
  <div class="header">
    <h1>üéì Question Generator</h1>
    <p>Generate personalized questions based on your learning preferences</p>
    

    <div class="progress-stats" *ngIf="totalQuestionsCount > 0">
      <div class="stat-item">
        <span class="stat-number">{{correctAnswersCount}}</span>
        <span class="stat-label">Correct</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">{{totalQuestionsCount}}</span>
        <span class="stat-label">Total</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">{{getAccuracyPercentage()}}%</span>
        <span class="stat-label">Accuracy</span>
      </div>
      <button mat-icon-button (click)="resetProgress()" class="reset-btn" matTooltip="Reset Progress">
        <mat-icon>refresh</mat-icon>
      </button>
    </div>
  </div>

  <div class="content">

    <mat-card class="form-card">
      <mat-card-header>
        <mat-card-title>Filter Criteria</mat-card-title>
        <mat-card-subtitle>Select the criteria to generate a relevant question</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <form [formGroup]="questionForm" (ngSubmit)="generateQuestion()">
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Educational Level</mat-label>
              <mat-select formControlName="level">
                <mat-option value="">Any Level</mat-option>
                <mat-option *ngFor="let level of levels" [value]="level">{{level}}</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Level Type</mat-label>
              <mat-select formControlName="levelType">
                <mat-option value="">Any Type</mat-option>
                <mat-option *ngFor="let type of levelTypes" [value]="type">{{type | titlecase}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Subject</mat-label>
              <mat-select formControlName="subject">
                <mat-option value="">Any Subject</mat-option>
                <mat-option *ngFor="let subject of subjects" [value]="subject">{{subject}}</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Topic</mat-label>
              <mat-select formControlName="topic">
                <mat-option value="">Any Topic</mat-option>
                <mat-option *ngFor="let topic of topics" [value]="topic">{{topic}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Skill</mat-label>
              <mat-select formControlName="skill">
                <mat-option value="">Any Skill</mat-option>
                <mat-option *ngFor="let skill of skills" [value]="skill">{{skill}}</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Sub-Skill</mat-label>
              <mat-select formControlName="subSkill">
                <mat-option value="">Any Sub-Skill</mat-option>
                <mat-option *ngFor="let subSkill of subSkills" [value]="subSkill">{{subSkill}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Sub-Sub-Skill</mat-label>
              <mat-select formControlName="subSubSkill">
                <mat-option value="">Any Sub-Sub-Skill</mat-option>
                <mat-option *ngFor="let subSubSkill of subSubSkills" [value]="subSubSkill">{{subSubSkill}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="button-group">
            <button mat-raised-button color="primary" type="submit" [disabled]="isLoading">
              <mat-icon *ngIf="isLoading">refresh</mat-icon>
              <mat-icon *ngIf="!isLoading">quiz</mat-icon>
              {{isLoading ? 'Generating...' : 'Generate Question'}}
            </button>
            
            <button mat-stroked-button type="button" (click)="clearForm()" [disabled]="isLoading">
              <mat-icon>clear</mat-icon>
              Clear Form
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>

    <mat-card class="question-card" *ngIf="generatedQuestion">
      <mat-card-header>
        <mat-card-title>Generated Question</mat-card-title>
        <mat-card-subtitle>Click "Show Answer" to reveal the solution</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <div class="question-content">
          <div class="question-text">
            <h3>‚ùì Question:</h3>
            <p>{{generatedQuestion.question}}</p>
          </div>

          <div class="answer-input-section" *ngIf="!showResult">
            <h3>‚úèÔ∏è Your Answer:</h3>
            <mat-form-field appearance="outline" class="answer-input">
              <mat-label>Type your answer here...</mat-label>
              <textarea 
                matInput 
                [(ngModel)]="userAnswer" 
                rows="3"
                placeholder="Enter your answer..."
                [disabled]="isLoading">
              </textarea>
            </mat-form-field>
            
            <div class="answer-actions">
              <button mat-raised-button color="primary" (click)="submitAnswer()" [disabled]="!userAnswer.trim()">
                <mat-icon>check</mat-icon>
                Submit Answer
              </button>
              
              <button mat-stroked-button (click)="toggleAnswer()">
                <mat-icon>visibility</mat-icon>
                Show Answer
              </button>
            </div>
          </div>

          <div class="result-section" *ngIf="showResult">
            <div class="result-feedback" [ngClass]="{'correct': isAnswerCorrect, 'incorrect': !isAnswerCorrect}">
              <div class="result-icon">
                <mat-icon>{{isAnswerCorrect ? 'check_circle' : 'cancel'}}</mat-icon>
              </div>
              <div class="result-text">
                <h3>{{isAnswerCorrect ? 'üéâ Correct!' : '‚ùå Not quite right'}}</h3>
                <p *ngIf="!isAnswerCorrect">Your answer: "{{userAnswer}}"</p>
              </div>
            </div>
            
            <div class="correct-answer" *ngIf="!isAnswerCorrect">
              <h4>‚úÖ Correct Answer:</h4>
              <p>{{generatedQuestion.answer}}</p>
            </div>
          </div>
          

          <div class="answer-section" *ngIf="showAnswer && !showResult">
            <h3>‚úÖ Answer:</h3>
            <p>{{generatedQuestion.answer}}</p>
          </div>
        </div>

        <div class="question-actions">
          <button mat-raised-button color="primary" (click)="generateNewQuestion()" [disabled]="isLoading">
            <mat-icon>refresh</mat-icon>
            Generate New Question
          </button>
          
          <button mat-stroked-button (click)="clearForm()" [disabled]="isLoading">
            <mat-icon>clear</mat-icon>
            Clear All
          </button>
        </div>
      </mat-card-content>
    </mat-card>


    <mat-card class="loading-card" *ngIf="isLoading">
      <mat-card-content>
        <div class="loading-content">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Generating your personalized question...</p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
